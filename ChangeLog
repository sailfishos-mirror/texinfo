2023-01-01  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/man.c (check_manpage_node): Use man --where instead of
	man -w to avoid clash with man program on Solaris, where -w
	means to update the whatis database.  Test failure on
	OpenSolaris 2022.10 reported by Bruno Haible.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/95moreindices.t:
	remove double_index_entry from t/95moreindices.t as there is a
	redundant test in tp/t/09indices.t.
	Rename tests such that the defaults are without suffix.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): use only
	one place in code to add the raw line in nested raw blocks.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization),
	(_process_remaining_on_line, _end_line_misc_line, _parse_texi):
	rename conditionals_stack as conditional_stack to match XS parser.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (%parser_state_initialization)
	(_process_remaining_on_line, _parse_texi),
	tp/Texinfo/XS/parsetexi/parser.c (raw_block_stack)
	(push_raw_block_stack, pop_raw_block_stack, process_remaining_on_line)
	(parse_texi): use a stack, raw_block_stack for nested raw block
	commands instead of putting them in the tree.

2023-01-01  Patrice Dumas  <pertusus@free.fr>

	* tp/t/09indices.t, tp/Makefile.tres: add test with index_table with
	default customization, rename former index_table as
	index_table_chapter_no_node.  Add explicit split nodes for Plaintext
	testing for index_nodes.  Split @file_encodings_tests out of
	@file_tests.  In @file_tests, do only testing of Info if it is
	expected to be different from the base case.  Keep spaces at end of
	line in test text only.

2022-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/list-of-tests: remove _info format tests as they
	are redundant with tests in t/*.t.

	* tp/tests/indices/list-of-tests: do not use the TEXI2HTML style
	for index_entries_relate_to_item test.

2022-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): read 'FORMAT_MENU' as a structuring
	option.  Only call Texinfo::Structuring::complete_node_tree_with_menus
	and Texinfo::Structuring::check_nodes_are_referenced if 'FORMAT_MENU'
	is set to menu.

	* tp/Makefile.tres, tp/t/30sectioning.t: add
	chapter_between_nodes_with_appendix and
	chapter_between_nodes_with_appendix_nomenu tests, in particular to
	have a case with Top next node automatic direction being determined 
	by the menu.

	* tp/t/10menu.t: remove 'FORMAT_MENU' => 'nomenu' from the
	converter/structuring options of simple_no_menu test, as it does not
	change the output.

2022-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/t/09indices.t,
	tp/tests/indices/Makefile.am (EXTRA_DIST),
	tp/tests/indices/list-of-tests: move
	index_special_region_no_insertcopying_html tests to tp/t/09indices.t.

2022-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (process_footnotes): handle the case
	of footnotes not associated with nodes.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/09indices.t,
	tp/tests/indices/Makefile.am (EXTRA_DIST),
	tp/tests/indices/list-of-tests: move index_special_region tests to
	tp/t/09indices.t.

2022-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/Makefile.am (EXTRA_DIST),
	tp/tests/indices/list-of-tests: remove index_special_region_no_region
	and index_special_region_no_region_html and the Texinfo file, as these
	are the same as index_special_region_no_insertcopying tests.

	* tp/tests/indices/index_special_region_no_insertcopying.texi:
	remove @setfilename.

2022-12-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (get_element_root_command_element)
	(_convert_printindex_command), doc/texi2any_api.texi (Target Commands
	Links@comma{} Texts and Associated Commands): add
	get_element_root_command_element to the API to return the element and
	root command associated to a tree element.  Use
	get_element_root_command_element in printindex conversion to determine
	the printindex root command target when there are no directions.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/09indices.t,
	tp/tests/indices/Makefile.am (EXTRA_DIST),
	tp/tests/indices/list-of-tests: move index_no_node_no_top test to
	tp/t/09indices.t, add test with USE_NODES to the default value.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/converters_tests.t,
	tp/tests/indices/list-of-tests: add tests based on
	indices_in_begin_tables_lists.texi to tp/t/converters_tests.t to test
	no tree transformation and tree transformation separately.  Change
	HTML indices_in_begin_tables_lists.texi in tp/tests/indices/list-of-tests
	not to use the texi2html style.

	* tp/Makefile.tres, tp/t/info_tests.t, tp/tests/indices/Makefile.am
	(EXTRA_DIST), tp/tests/indices/list-of-tests: move index_one_node test
	to tp/t/info_tests.t and inline it.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/layout/list-of-tests: add 'Need collation compatibility'
	for two more tests.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sort_indices): add comments on
	how to test compatibility of Unicode::Collate with tests.

	* configure.ac, tp/defs.in (PERL_UNICODE_COLLATE_OK), tp/t/09indices.t,
	tp/tests/run_parser_all.sh (check_unicode_collate_ok),
	tp/tests/layout/list-of-tests, tp/tests/tex_html/list-of-tests:
	Add a configure.ac test for perl 5.18.1 which seems to be the
	first compatible version with the tests results for test using Unicode
	collation.  Use that test result in run_parser_all.sh to skip tests
	with 'Need collation compatibility' put on their command line.
	Skip similarly tests in tp/t/09indices.t based on perl version too.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sort_indices): give the 'UCA' => 22
	argument to Unicode::Collate to have a stable collation.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/09indices.t,
	tp/tests/indices/Makefile.am (EXTRA_DIST),
	tp/tests/indices/list-of-tests: move index_table test to
	tp/t/09indices.t, move the texinfo file too.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/09indices.t, tp/tests/indices/Makefile.am
	(EXTRA_DIST), tp/tests/indices/list-of-tests: move interesting
	index_and_node_same_name.texi and index_entry_in_footnote.texi
	related tests to tp/t/09indices.t and inline them, renaming
	index_entry_in_footnote as index_entry_in_footnote_sections, as
	already the index_entry_in_footnote very similar test.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/09indices.t, tp/tests/indices/Makefile.am
	(EXTRA_DIST), tp/tests/indices/list-of-tests: move
	printindex_between_node_section and printindex_between_part_chapter
	tests out of tp/tests/indices/list-of-tests to tp/t/09indices.t and
	inline them instead of using Texinfo files.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/09indices.t,
	tp/tests/indices/Makefile.am (EXTRA_DIST),
	tp/tests/indices/list-of-tests: move index_nodes.texi and related
	tests from tests/indices/list-of-tests to tp/t/09indices.t.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/Makefile.am (EXTRA_DIST): remove the
	index_split.texi file in tp/tests/indices/, which is unused, and
	redundant with the one in tp/t/input_files/.  Also remove
	same_doc_nr_split_index_and_element.texi which does not seems to be
	used anywhere.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/Makefile.am (EXTRA_DIST): remove the
	nodes_before_top_and_sections.texi file in tp/tests/indices/, which is
	now unused, and redundant with the one in tp/t/input_files/.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/95moreindices.t,
	tp/tests/indices/list-of-tests: add
	nodes_before_top_and_sections_chapter and
	nodes_before_top_and_sections_chapter_no_node tests to
	95moreindices.t, and remove the equivalent tests (which also used the
	texi2html style) from indices/list-of-tests.

2022-12-30  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking: mention help2man as a program the version of
	which is important for making a release.

2022-12-30  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi, doc/info-stnd.texi, doc/texi2any_api.texi:
	Adjust copyright notice slightly to match recommended wording.
	From Hilmar Preuße.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Customization Variables),
	tp/Texinfo/Convert/HTML.pm (%default, output)
	(_set_variables_texi2html), tp/t/95moreindices.t: set
	NODE_NAME_IN_INDEX based on USE_NODES is undef.  Move
	NODE_NAME_IN_INDEX documentation to HTML Customization Variables.

2022-12-30  Patrice Dumas  <pertusus@free.fr>

	* tp/t/95moreindices.t: do not set TEXI2HTML, instead set specific
	customization variable relevant for the test.

	* tp/tests/indices/nodes_before_top_and_sections.texi: correct
	@setfilename.
2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (test): update tree transformation names
	for relate_index_entries_to_items.

	* tp/t/transformations.t, tp/Makefile.tres: add tests using
	tests/indices/index_entries_relate_to_item.texi without and
	with the relate_index_entries_to_items transformation.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/index_entries_relate_to_item.texi: add a
	@printindex.

	* tp/tests/indices/list-of-tests: remove --html from
	index_entries_relate_to_item such that there are both HTML and Info
	generated (even though we are mainly interested in HTML output).

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/index_entries_relate_to_item.texi: remove
	@setfilename, and @node Top and @top.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/indices/index_entries_relate_to_item.texi:
	add file on behalf of Arsen Arsenović, corresponding to
	the 2022-12-27  Arsen Arsenović entry.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (TEXI2DVI_ENVIRONMENT): use braces instead of
	parentheses for variable names to ease cut and pasting to shell.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2oldapi.texi: add information in comments on how to
	process in source.  Fix to be processable.  More prominently
	state that the API description is obsolete and dates from 2010/2012.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (@command{texi2html}): remove reference to
	util/texi2html, as it has been removed.

2022-12-29  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (\defunargs): Wrap in a group to limit
	@var redefinition.

2022-12-29  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Makefile.am (dist-hook): Do not distribute architecture-
	dependent gettext_xs.o file.  Report from Hilmar Preuße.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_informative_command_output)
	(_latex_begin_output, _convert): add _informative_command_output
	that returns LaTeX output code for informative @-commands based
	on code in _convert, use it in _convert.  In _latex_begin_output
	also call _informative_command_output for informative commands
	that have a different customization option value from the LaTeX
	default.

	* tp/t/latex_tests.t, Makefile.tres: add
	customize_informative_commands test to test customization options for
	informative @-commands.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%document_settable_multiple_at_commands):
	change some defaults, set utf-8 for documentencoding and set
	documentlanguage and micrtype undef.

2022-12-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_informative_command_value): get information
	for line commands of type line, using the first args contents if it is
	text.

	* tp/Texinfo/Common.pm (set_informative_command_value),
	tp/Texinfo/Convert/LaTeX.pm (_convert): add a return
	status from set_informative_command_value(), true if the customization
	variable was set.  Output code related to a command associated to a
	customization variable in LaTeX only if the customization variable
	was set.

	* tp/Texinfo/Config.pm (set_conf), tp/Texinfo/Convert/Text.pm
	(set_conf): add a return status for consistency with
	Texinfo::Convert:Converter set_conf.

	* tp/t/latex_tests.t: add
	setchapternewpage_on_odd_titlepage_set_headings test, with headings
	customization variable set.

2022-12-29  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (@cartouche): Do not use @emph inside
	@cartouche argument as font styles do not accumulate in TeX output.

2022-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_begin_document): do not set
	$self->{'titlepage_done'}, it is not used anymore.

2022-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_latex_begin_output, _begin_document)
	(_set_chapter_new_page): initialize based on setchapternewpage and
	headings customization variables values.  Set headings off just before
	the titlepage, and reset afterwards to headings customization
	variables values.  Return headings set together with setchapternewpage
	to avoid setting headings again when initializing.
	Set headings each time after setting setchapternewpage.

2022-12-28  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (@code{@@headings}): Update now that @titlepage
	does not do "@headings on".

2022-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_begin_document): add a special page
	style for Table of Contents which only shows the page number, to avoid
	an ugly Chapter 0.  Set mainmatter after the Table of Contents.

2022-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (output, convert, _convert):
	do not use element units, simply convert the tree.  Sections closed by
	root commands do not span following nodes.

2022-12-28  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): check
	that a nested @macro is followed by space or at end of string.

	* tp/t/60macro.t, tp/Makefile.tres: add
	macro_imbricated_with_beginning_command_name test with an @-command
	beginning with @macro imbricated in @macro.

2022-12-28  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex, NEWS: Turn microtype off by default, for speed.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	update po files

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line): add end of
	line if needed for nested @ignore with comment.

	* tp/Texinfo/XS/parsetexi/parser.c (read_comment): fix offset with
	@comment.  Skip the @ in comment command name.

	* tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	put the correct string in @ignore comment.  Advance instead of exiting
	when there is a @ that is not a comment.

	* tp/Makefile.tres, tp/t/55conditionals.t: do not skip
	nested_ignore_with_comments.  Add comment without
	argument in @ignore line examples.  Add nested_ignore_comment_no_eol
	to test a very specific case of no end of line after nested @ignore
	and comment.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XSLoader.pm (init): show the DynaLoader error message
	if dl_load_file failed.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/end_line.c: defined floats lists related
	symbols to avoid non-defined symbols linking errors, even if there
	is no code run that uses those symbols.

	* tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block):
	fix check of variadic flag and negation precedence.

	* tp/Texinfo/XS/parsetexi/parser.c (parse_texi): wipe input stack
	after getting the text after @bye.

	* tp/Texinfo/XS/parsetexi/api.c (build_global_info2),
	tp/Texinfo/XS/parsetexi/parser.c (register_global_command)
	(wipe_global_info): really register float as a global command.  Use
	floats for global_info for float as using float breaks, most likely
	because it is a type.

	* tp/Texinfo/Convert/NodeNameNormalization.pm (set_float_types):
	initialize $self->{'floats'}.

	* tp/Texinfo/XS/parsetexi/parser.c (read_comment),
	tp/Texinfo/XS/parsetexi/parser.c  (process_remaining_on_line):
	fix a one off string length error in read_comment.  Fix a typo
	in comments searching on nested @ignore line.  Avoid an infinite loop
	when there is a comment.

	* t/55conditionals.t: add nested_ignore_with_comments, skipped for now
	as the results are incorrect.

2022-12-27  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\indexnofonts): Remove superfluous space
	token recently added to definition by accident.

2022-12-27  Gavin Smith  <gavinsmith0123@gmail.com>

	No colour change for black links

	* doc/texinfo.tex (\setcolor) [pdfTeX]: Keep track of the current
	colour so that in the default case, when everything is black, there
	is no \mark output or pdf output, which is faster when the document
	contains many links.

2022-12-27  Arsen Arsenović  <arsen@aarsen.me>

	Re-enable copyable anchors in HTML output

	* tp/Texinfo/Common.pm (relate_index_entries_to_table_items_in_tree)
	(%valid_tree_transformations): Implement
	relate_index_entries_to_table_items, a transform that finds all
	table terms and associates their indices with them, so that the
	HTML backend generates a copyable anchor.

	* tp/texi2any.pl: Invoke the new
	relate_index_entries_to_table_items transform.
	(%formats_table): Enable the relate_index_entries_to_table_items
	transformation on HTML.
	* tp/tests/indices/list-of-tests (index_entries_relate_to_item):
	New test case.
	* tp/tests/indices/index_entries_relate_to_item.texi: New test file.

2022-12-27  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\definedummies, \indexnofonts):
	Extend dummy definitions in \definedummies to include the
	\indexnofonts expansions.  Always remove braces from
	arguments for dummied control words.
	
	(\atdummies, \indexnofonts):
	Give a suitable definition before using \macrolist to avoid
	user-defined @macro's repeatedly being given longer and longer
	definitions.

2022-12-27  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\definedummies): Remove dummies for
	internal commands to avoid need for redirection.
	(\atdummies): Call \turnoffactive rather than
	\normalturnoffactive followed by \otherbackslash, as this should
	do the same thing and is shorter.

2022-12-27  Gavin Smith  <gavinsmith0123@gmail.com>

	Switch for dummies

	* doc/texinfo.tex (\definedummies):
	Give control sequences alternate expansions depending on
	whether they are being expanded when being written to an
	auxiliary file, using \ifdummies and \ifindexnofonts
	conditionals.  Use @ as the escape character for dummy
	expansions.  Call \definedummies at the end of the file.
	This may make processing files faster due to less redefinitions
	being made.

	(\commondummiesnofonts): All redefinitions moved to \definedummies
	and macro removed.
	(\atdummies): Set \dummiestrue and inline what is left of
	the old definition of \definedummies.
	(\indexnofonts): Set \indexnofontstrue.  Definitions in
	\indexnofonts still override those from \definedummies.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_block_command),
	tp/Texinfo/XS/parsetexi/parser.c (read_comment)
	(process_remaining_on_line): handle nested @ignore.  Gavin report.
	Add read_comment() to get a comment, taken mainly from
	handle_block_command.

	* tp/t/55conditionals.t, tp/Makefile.tres: add test
	ignore_spaces_and_comments with comments and spaces on @ignore lines.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_latex_header), doc/texinfo.texi
	(@LaTeX{} Customization Variables), tp/Texinfo/Common.pm
	(@variable_string_settables): add experimental LaTeX documentclass and
	packages customization, using two customization variables,
	CLASS_BEGIN_USEPACKAGE and END_USEPACKAGE. 

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): format @bye line
	similarly to other skipline @-commands.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (%type_elements, _convert),
	tp/Texinfo/ParserNonXS.pm (_parse_texi),
	tp/Texinfo/XS/parsetexi/element_types.txt,
	tp/Texinfo/XS/parsetexi/parser.c (parse_texi),
	tp/Texinfo/Convert/*.pm, util/texinfo.dtd: keep text appearing after
	@bye in the Texinfo Tree, as text_after_end in postamble_after_end
	container.  Add postamble_after_end as ignorable type in converters.

2022-12-27  Patrice Dumas  <pertusus@free.fr>

	* t/html_tests.t: fix incorrect braces nesting.

	* t/test_utils.pl: with -c do not add @bye even if it is not at
	the beginning of the line and if followed by @.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sort_indices): when splitting at letters,
	determine letters by removing diacritics to associate accented letters
	to the main letter.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (setup_index_entry_keys_formatting): set
	sort_string option for conversion to text only if ENABLE_ENCODING is
	unset or encoding is not UTF-8.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (Conditional Nesting): comment out text on @ignore
	line.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	Obey --disable-encoding/ENABLE_ENCODING for some conversions to text

	* doc/texi2any_api.texi (Command Tree Element Conversion Functions),
	tp/Texinfo/Convert/HTML.pm (%default_commands_args, _convert),
	tp/ext/epub3.pm (epub_convert_image_command): do not set
	copy_options_for_convert_text second argument for monospacetext, add
	filenametext for which the second argument of
	copy_options_for_convert_text is set and ENABLE_ENCODING is ignored.
	Update code to use filenametext if the output is a file name.

	* tp/Texinfo/Convert/LaTeX.pm (converter_initialize, _convert),
	tp/init/highlight_syntax.pm (highlight_process),
	tp/Texinfo/Convert/HTML.pm (_convert_def_line_type)
	(_external_node_href, output_internal_links, output): do not set the
	second argument of copy_options_for_convert_text to obey
	ENABLE_ENCODING for some conversions to plain text.

	* doc/texinfo.texi (Invoking @command{texi2any}),
	tp/Texinfo/Convert/Text.pm, tp/texi2any.pl: document that
	ENABLE_ENCODING is obeyed for some conversions to plain text and
	for index sorting.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.tres, tp/t/latex_tests.t: add a new test,
	indices_disable_encoding with the same text as indices, but with
	ENABLE_ENCODING set to 0.

	* t/include/text_only_image.txt: add to git.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	Set --enable-encoding to be the default for all output formats

	* tp/Texinfo/Common.pm (%default_converter_command_line_options),
	tp/Texinfo/Convert/TexinfoXML.pm (%defaults): set ENABLE_ENCODING
	to 1 in the default case for all the formats.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/t/latex_tests.t: in indices test, add simple entry with
	accented letters.

2022-12-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_latex_header): do not use noclearpage
	imakeidx option, as the index may not appear in that case, if at the
	end of the document.

2022-12-26  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Move more macros to be defined while \ is
	still the escape character, as this is easier to read.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Provide \ a definition again when Texinfo
	is not a preloaded format.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Use \everyjob to redefine backslash in
	case of preloaded Texinfo only.
	(\enablebackslashhack, \newlineloadsconf): Rename.
	Do not provide backslash with a definition here.  Capture end
	of line as an argument to avoid need for two-stage redefinition
	of newline.

	(\fixbackslash, \loadconf): Rename to \loadconf, as it is not
	used to fix backslash in the usual case where Texinfo is not
	preloaded.  Begin with \relax rather than space token to terminate
	filename.

2022-12-25  Patrice Dumas  <pertusus@free.fr>

	Use OUTPUT_CHARACTERS instead of --enable-encoding for XML-based and
	LaTeX

	* NEWS, doc/texinfo.texi (@code{@@documentencoding})
	(Other Customization Variables), tp/Texinfo/Common.pm
	(@variable_string_settables), tp/Texinfo/Convert/Converter.pm
	(xml_accents), tp/Texinfo/Convert/HTML.pm (_convert_accent_command)
	(_css_string_convert_accent_command, _convert_text)
	(converter_initialize), tp/Texinfo/Convert/LaTeX.pm
	(converter_initialize, copy_options_for_convert_to_latex_math)
	(_convert), /tp/Texinfo/Convert/TexinfoMarkup.pm (_convert):
	use the OUTPUT_CHARACTERS customization variable for HTML, XML,
	DocBook and LaTeX to determine if encoded characters are output
	instead of entities or macros.

	* t/09indices.t, tp/t/formats_encodings.t, tp/t/html_tests.t,
	tp/tests/layout/list-of-tests,
	tp/tests/many_input_files/different_encodings.sh: set
	OUTPUT_CHARACTERS in addition to ENABLE_ENCODING/--enable-encoding.

2022-12-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (convert_accents, xml_accents),
	tp/Texinfo/Convert/HTML.pm (_convert_accent_command)
	(_css_string_convert_accent_command),
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): convert accents
	to encoded characters in convert_accents based on the third
	argument, instead of checking ENABLE_ENCODING.  Update callers.

2022-12-25  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (sort_indices): set variable collation
	elements to 'Non-Ignorable' such as to have spaces and punctuation
	marks sort before letters.

2022-12-25  Patrice Dumas  <pertusus@free.fr>

	Sort index entries using Unicode Collation in texi2any

	* tp/Texinfo/Structuring.pm (_collator_sort_string)
	(_sort_index_entries, sort_indices): use Unicode::Collate comparison
	for strings.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	Attempt to fix pre-dumped Texinfo

	* doc/texinfo.tex: Remove blank line from end of file.
	(\enablebackslashhack): Comment out ends-of-line.  This should
	stop \fixbackslash being run too early.
	(\fixbackslash): Start definition with a space token.

	This has been broken since at least 2017-04-17 when extra
	lines were added to \fixbackslash, so its likely that nobody
	is using Texinfo as a pre-dumped format.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Move definitions of \normaldot, \normalquest
	and \normalslash.  Call \setregularquotes near definition.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: At end of file, move more definitions before
	the change from \ to @ as the escape character.
	(\normalturnoffactive, \turnoffactive): Define \normalturnoffactive
	in terms of \turnoffactive instead of vice versa.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	Reduce scope of catcode changes throughout texinfo.tex

	* doc/texinfo.tex: Surround character encoding definition macros
	in a group, define with \gdef and limit the catcode changes
	for non-ASCII characters to the group.  Move the use of
	@documentencoding to the very end of the file.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Remove "emacs-page" delimiter from the one
	place it occurs.  Remove vim shiftwidth definition from end of file.

2022-12-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex: Use definition of @documentencoding to
	fully set UTF-8 as the default encoding, including for XeTeX
	and LuaTeX.  Report from Werner.

2022-12-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_in_paragraph),
	tp/Texinfo/XS/parsetexi/handle_commands.c (in_paragraph):
	go to the container of the parent command when going through
	parent brace commands.

	* tp/t/08misc_commands.t: add indent_in_command_in_paragraph
	test with @indent and @noindent in an @-command in a paragraph.

2022-12-24  Patrice Dumas  <pertusus@free.fr>

	Warn that @indent and @noindent are useless inside paragraphs

	* tp/Texinfo/ParserNonXS.pm (_in_paragraph)
	(_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/handle_commands.c (in_paragraph)
	(handle_other_command): add in_paragraph that returns true if
	in a paragraph, including in a brace @-command except for a context
	brace command.  Use that function to warn if @indent or @noindent
	are in a pragraph.

2022-12-24  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm: cut at 80 columns, reindent.

2022-12-24  Patrice Dumas  <pertusus@free.fr>

	Warning for block commands without argument with an argument

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block):
	warn if a block command with 0 argument, and not a variadic command
	has arguments on the line.

2022-12-24  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (TEXINFO_TEX): use in-source texinfo.tex.

2022-12-24  Patrice Dumas  <pertusus@free.fr>

	* NEWS: add title for @cartouche.

2022-12-23  Gavin Smith  <gavinsmith0123@gmail.com>

	Title for cartouche

	* doc/texinfo.tex (\cartouche): Define with \envparseargdef so
	to take an argument.  If argument is given, use it as a title for
	the box.
	(\envparseargdef): Define with \long.

	Feature request from Arnold Robbins.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* .gitattributes: set tp/t/results/*/*.pl file always diff-able.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Info.pm (format_image): fix count of lines
	returned when there is an image text file.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Info.pm (format_image): avoid warnings about
	undefined values with @image with alt and text but no image file.

	* tp/Makefile.am (test_files), tp/Makefile.tres, tp/t/info_tests.t,
	tp/t/include/text_only_image.txt: new test
	image_text_file_only_and_alt with alt and text file but no image file.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm
	(normalize_transliterate_texinfo, transliterate_texinfo): modify
	transliterate_texinfo such that it only transliterates but does not
	protect characters, and add normalize_transliterate_texinfo for the
	previous behaviour.  Update callers.

	* tp/Texinfo/Convert/LaTeX.pm (_prepare_floats): transliterate the
	first float element type of a float type to set up the LaTeX float
	name to get more different categories when float type expands to
	non-ASCII characters.

	* tp/t/27float.t: expand LaTeX output for the float_with_at_commands
	test.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_prepare_floats): fix type filtering
	regex.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (_parse_float_type):
	convert float type using NodeNameNormalization.pm
	convert_to_normalized().

	* tp/t/27float.t: new test special_characters_in_float_type.

2022-12-23  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/NodeNameNormalization.pm (_parse_float_type)
	(set_float_types), tp/Texinfo/ParserNonXS.pm (_end_line_misc_line)
	(_end_line_starting_block, _parse_texi),
	tp/Texinfo/XS/parsetexi/Parsetexi.pm (get_parser_info)
	(_set_errors_node_lists_labels_indices),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block)
	(end_line_misc_line), tp/Texinfo/command_data.txt: make float a global
	commmand. Move normalization of float type out of parsers to
	NodeNameNormalization.pm for future normalization using functions
	there.

2022-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm: cut at 80 columns better.

2022-12-22  Patrice Dumas  <pertusus@free.fr>

	Handle @float in @cartouche in LaTeX, where it cannot float

	* tp/Texinfo/Convert/LaTeX.pm
	(%LaTeX_non_floating_environment_commands, _latex_header)
	(_push_new_context, _convert): add a stack of commands in which
	there cannot be floats, non_floating_commands, for cartouche which
	uses mdframed.  In this context, use a no-op environment for float
	and \captionof of the caption package.

2022-12-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_push_new_context, _convert): carry
	formatted context over to float.

	* tp/Makefile.tres, tp/t/27float.t: add float_in_block_commands
	test.

2022-12-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm: reindent, cut at 80 columns,
	use scalar() explicitely.

2022-12-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Plaintext.pm (_convert): do not consider the
	cartouche title to be a paragraph, reset paragraph count to the value
	before the title.
	Do not set the text_element_context counter, as the title is on its
	own line.  Do not increase redundantly lines count.

	* tp/Makefile.tres, tp/t/02coverage.t: add cartouche_title_and_content
	new test with cartouche title and some content in the cartouche.

2022-12-21  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (@code{@@cartouche}): document the title argument
	of @cartouche.
	Describe that @cartouche can be used for to isolate a portion of the
	manual from the main flow, corresponding to the sidebar explanation in
	DocBook.

2022-12-20  Patrice Dumas  <pertusus@free.fr>

	Use @cartouche argument as cartouche title in texi2any

	* tp/Texinfo/Convert/DocBook.pm (_convert), tp/Texinfo/Convert/HTML.pm
	(_convert_cartouche_command, _convert), tp/Texinfo/Convert/LaTeX.pm
	(_set_environment_options), tp/Texinfo/Convert/Plaintext.pm
	(_convert), tp/Texinfo/Convert/TexinfoMarkup.pm
	(%commands_args_elements), tp/Texinfo/Convert/Text.pm (_convert),
	tp/Texinfo/command_data.txt, util/texinfo.dtd: add an argument to
	@cartouche.  Format the @cartouche argument as the cartouche title.
	Based on a report from Arnold Robbins.

	* tp/t/02coverage.t: add @cartouche argument in cartouche and
	comment_on_cartouche_line tests.

	* tp/tests/coverage_macro.texi: add @cartouche with argument.

2022-11-19  Werner Lemberg  <wl@gnu.org>

	* doc/texinfo.tex (\code, \dashnobreak): Use a \penalty to disable
	hyphenation for LuaTeX.

2022-12-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): use <sidebar> for
	@cartouche. Based on a report from Arnold Robbins.

2022-12-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\-): Provide definition of @- to allow
	a hyphen to be printed for optional line breaks.  From Werner.

2022-12-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\code, \tclose): Comments changed.

2022-12-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\printdefunline): Call \defcharsdefault
	before creating the index entry in case it contains an ampersand
	or bracket.

2022-12-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\defindex, \defidx): Rename to
	\defidx to avoid clash with @defindex command.

2022-12-17  Gavin Smith  <gavinsmith0123@gmail.com>

	Turn off hyphenation for tt fonts completely.

	* doc/texinfo.tex (\setfont): Set \hyphenchar to -1 for
	font styles tt, ttb and ttsl.
	(\nohyphenation): Remove.
	(\key, \tclose, \verb): Do not call \nohyphenation.

	Werner reported that the restoration of \hyphenchar in
	\nohyphenation was wrong as it affected the wrong font.

2022-12-15  Gavin Smith  <gavinsmith0123@gmail.com>

	Configurable index for @def* command

	* doc/texinfo.tex (\defindex, \deftext): Define with \newtoks.
	(\defind): New macro to set \defindex and \deftext.  Call it
	instead of \doind throughout the definitions with \makedefun.
	(\printdefunline): Call \doind using the values that were set
	in \defindex and \deftext.
	(\useindex): Command to overrwrite \defindex value.

2022-12-15  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\dodefunx): Inline into use site in definition
	of \deffoox in \makedefun.  Do not reuse the definition of
	\deffoo manipulating its expansion with the \gobbledefun macro,
	as this was confusing and unnecessary.  No functional changes
	intended.

2022-12-14  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (PARAGRAPH):
	Rename 'protect_spaces' to 'no_break'.

2022-12-14  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/ParagraphNonXS.pm
	(set_space_protection, add_text): Rename 'space_protection' flag
	'no_break' to reflect its function.

2022-12-14  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/texi2any.pl <.info filename check>: Do not use /r flag
	for regex to work with older versions of Perl.

2022-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): add end of line
	for multitable with prototype interrupted by another @-command.

2022-12-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/util.c (text_buffer_iconv): Correctly update arguments
	for iconv in loop.  Crash for "info groff" reported by Jakub Wilk
	via Hilmar Preuße <hille42@web.de>.

2022-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): add end of line
	for block commands with missing args key, except for @def*, which have
	a special processing of their line.

2022-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/t/converters_tests.t: in form_feeds test, add more form feeds for
	@deffn command and add @deffnx command.

2022-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): use
	_leading_spaces_arg for def_line type.

2022-12-12  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert), util/txixml2texi.pl:
	always add end of line for the block command lines.

	* t/57invalid_nestings.t (@formatted_cases): add
	section_on_cartouche_line.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert), util/texinfo.dtd: if
	the @itemize or @*table command as argument was added, add a
	automaticcommandarg attribute set to on.

	* util/txixml2texi.pl: add a space after @*table and before the
	formatting command if there is not already one.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): do not add an
	entry for erroneous @itemx/@item/@tab constructs.

	* tp/t/57invalid_nestings.t: put itemx_in_itemize_enumerate_in_table
	in @formatted_cases, in particular to check XML output.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* util/txixml2texi.pl: handle infoenclose.

2022-12-11  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/HTML.pm (%css_element_class_styles),
	(_convert_text) <in non breakable space>: Do not output
	<span class="w-nolinebreak-text"> element as it is not clear
	that it is needed to prevent breaking at - or _.

2022-12-11  Gavin Smith  <gavinsmith0123@gmail.com>

	Do not copy spaces exactly for @w

	* tp/Texinfo/XS/xspara.c (xspara_add_text) <protect_spaces>
	* tp/Texinfo/Convert/ParagraphNonXS.pm (add_text) <protect_spaces>:
	Change the meaning of this flag to match what @w does in
	texinfo.tex, which simply uses an \hbox for the content, but does
	not protect the spaces.  Do not use exactly the same spaces that
	were given in the input.  Accumulate spaces onto the end of the
	current word so that all spaces and words will be stuck together
	while in the mode and output together in the same line.
	* tp/t/paragraph.t: Manually update reference test results.

	The 'protect_spaces' flag is probably now misnamed.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): add multitable
	space after argument.

2022-12-11  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text) <space>,
	* tp/Texinfo/Convert/ParagraphNonXS.pm (add_text) <space>:
	Remove extra call to _add_pending_word or xspara__add_pending_word.

2022-12-11  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/XS/xspara.c (xspara_add_text): Make the same change
	so to mirror the structure of the Perl code.

2022-12-11  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/ParagraphNonXS.pm (add_text) <spaces>:
	Separate out code for 'unfilled' to make the rest of the code
	easier to understand.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): add a newline
	at the end of block command lines if there is none (case of another
	command interrupting the block command line).

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/maintain/check_back_xml_forth_texi_t.sh: handle 3 digits in
	front of .t test file name.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): use directly
	the @node direction explicit args, reconstitute node and manual name
	only for automatic directions.

	* tp/t/57invalid_nestings.t: move on_node_line to @formatted_cases
	to output XML.

2022-12-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block):
	more generic message when @*table argument is incorrect, separating
	missing and bad argument, and showing the argument in case of bad
	argument.

	* tp/Texinfo/XS/parsetexi/convert.c (expand_cmd_args_to_texi):
	add spaces_after_cmd_before_arg expansion.

2022-12-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/Plaintext.pm (_convert) <@tie>:
	Use add_next instead of add_text to add space, and do not
	use 'w' formatter stack or call set_space_protection.

2022-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_isolate_last_space),
	tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space): do not set
	comment_at_end for brace commands.

2022-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert_argument_and_end_line)
	(_convert): convert comment_at_end from brace commands.

	* tp/t/30sectioning.t: output XML for empty_ref_arg test.

2022-12-10  Gavin Smith  <gavinsmith0123@gmail.com>

	&nbsp; for @verb

	* tp/Texinfo/Convert/HTML.pm
	(_convert): Use 'space_protected' context for @verb as
	well as for @w.  Do not use 'verbatim' context for @verb.
	This means that in _convert_text, spaces in the argument
	to @verb will be converted to &nbsp;.

2022-12-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\verb): Revert recent change, so that
	line breaks at spaces are not possible, for agreement with
	LaTeX \verb command and so that spaces in argument will always be
	apparent to the reader.

2022-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert), util/texinfo.dtd,
	util/txixml2texi.pl: add trailing spaces in block commands arguments.

	* tp/t/converters_tests.t (@test_cases):  add form feeds on @float
	line in form_feeds test.

	* tp/t/16raw.t: move spurious_arg_on_line, beginning_and_end_on_line
	and space_before_end from @test_invalid to @test_cases.  Output
	XML in @test_cases.

	* tp/t/08misc_commands.t: add XML output for
	codequoteundirected_codequotebacktick and
	comment_space_command_on_line tests.

	* tp/t/57invalid_nestings.t: move ignored_text from @test_cases
	to @formatted_cases.

	* tp/t/30sectioning.t: add XML output for node_up_external_node,
	space_in_node and next_no_prev_to_node.

2022-12-10  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): associate end
	space to the last empty argument if possible.

	* tp/t/27float.t: add XML output format to the tests.

2022-12-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* install-info/install-info.c (error): Declare as static to
	avoid clash with error function from glibc, called from gnulib.
	Report from Sam James <sam@gentoo.org> and suggested solution
	from Arsen Arsenović <arsen@aarsen.me>.

2022-12-09  Patrice Dumas  <pertusus@free.fr>

	* tp/t/18itemize.t (@test_cases): add more tests of accents
	on @itemize lines in empty_accent_argument and accent_argument.

	* tp/t/22xtable.t (@test_cases): add more tests of accents
	on @table line in accent_on_table_line.

2022-12-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line):
	do not consider accent commands to be associated to @itemize
	or @*table.  End the line if there is an accent followed by
	end of line on a block command or line command.

2022-12-07  Patrice Dumas  <pertusus@free.fr>

	* tp/t/input_files/bib-example.texi: use @w{} to avoid mark command
	for @itemize.

	* tp/t/18itemize.t: add xml output for @test_cases.

2022-12-07  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (%no_arg_commands_formatting),
	util/texinfo.dtd: use &ampsymbol; for @& to avoid using the &amp;
	entity already used for & in text in XML.  &ampsymbol; ultimately maps
	to &amp; in DTD.

	* tp/tests/coverage_macro.texi: add @&.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/t/19def.t: move all_empty_def to @test_info and format to xml
	@test_info tests.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_def_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line): do not call
	abort_empty_line when processing the @def* line, there is no empty
	line to abort.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_merge_text): use explicitely scalar()
	for clearer code.

	(_isolate_last_space, _end_line_def_line): better debugging output.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/t/01use.t: update tree.  Do not use 'use vars'.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_parse_def),
	tp/Texinfo/XS/parsetexi/def.c (next_bracketed_or_word_agg)
	(split_def_args, parse_def): remove code setting spaces_at_end on
	@def* lines, as it cannot happen anymore.  Remove use of spaces_at_end
	def line type.

	* tp/Texinfo/XS/parsetexi/def.c: remove unused next_bracketed_or_word
	function.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Transformations.pm (fill_gaps_in_sectioning): tree
	element added for new section more in line with current tree elements.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_starting_block): allow only
	one letter as @enumerate argument (same as XS parser).

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_end_line_def_line),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line)
	tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Convert/TextContent.pm (_convert): isolate last space
	on @def* command line similarly to other formats with
	isolate_last_space.

	* tp/Texinfo/ParserNonXS.pm (_isolate_last_space): check that there
	is content before trying to isolate last space.

	* tp/Texinfo/ParserNonXS.pm (_merge_text, _end_line_def_line)
	(_end_line_starting_block, _process_remaining_on_line): improve/add
	debug messages.

2022-12-06  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (_parent_string, debug_print_element_short)
	(debug_print_element): add an optional argument to
	debug_print_element_short to show the parent element name or type.

2022-12-05  Patrice Dumas  <pertusus@free.fr>

	* layout/list-of-tests: add layout formatting_info_disable_encoding
	test, testing Info output coverage with --disable-encoding.

2022-12-05  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (TEXI2DVI, TEXI2DVI_ENVIRONMENT),
	doc/tp_api/Makefile.am (TEXI2DVI, TEXI2DVI_ENVIRONMENT): use in-source
	texindex and texi2dvi.

	* tp/Makefile.tres: update.

2022-12-04  Patrice Dumas  <pertusus@free.fr>

	* tp/t/57invalid_nestings.t: add tests of section command interrupting
	block command lines that requires gathering tree information,
	section_on_multitable_line, section_on_float_line,
	section_on_enumerate_line, section_on_xtable_line,
	and section_on_itemize_line.

2022-12-04  Patrice Dumas  <pertusus@free.fr>

	Gather tree information when closing incorrectly nested block command line

	* tp/Texinfo/ParserNonXS.pm (_close_current, _end_line_starting_block)
	(_end_line), tp/Texinfo/XS/parsetexi/close.c (close_current): when
	closing block_line_arg in close_current, use the same code as when
	closing at end of line, such as to gather all the information in the
	tree.

2022-12-04  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/tests/coverage,
	* tp/tests/coverage/list-of-tests,
	* tp/tests/coverage/formatting_utf8.texi: Remove.  list-of-tests
	only had one commented-out line.  formatting_utf8.texi was an
	old copy of layout/formatting.texi with an added
	"@documentencoding utf8" line.

2022-12-04  Patrice Dumas  <pertusus@free.fr>

	* util/texinfo.dtd: allow mixing *caption within float contents.  Fix
	email spaces attributes.

2022-12-04  Patrice Dumas  <pertusus@free.fr>

	* tp/t/converters_tests.t: add inlinefmtspaces, inlinerawspaces
	and inlineifsetifclearspaces, similar with other formatted tests but
	with soaces around arguments.

	* util/texinfo.dtd: fix the type of spaces attributes, @inline*
	arguments are optional.

2022-12-04  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (\pdflink) <XeTeX>: Fix definition.

2022-12-04  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/LaTeX.pm (_convert) <@verb>:
	Check \verb delimiter character is not used in contents,
	and change newlines to spaces.
	* tp/t/latex_tests.t (verb): New test.

2022-12-04  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\verb): Turn off hyphenation as this can
	introduce spurious hyphen glyphs in the output.  Allow breaking
	at spaces by using \obeyspaces rather than \sepspaces.  Do not
	obey line breaks, for consistency with HTML output.  Report from
	Werner.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* TODO: add @node and HTML splitting

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	Atomic dir update

	* install-info/install-info.c (output_dirfile):
	If rename to dir file failed, try deleting target file
	and try again.  From Eli.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	Clickable section title in @contents for PDF

	* doc/texinfo.tex
	(\pdflinkpage): Generalise definition of \pdflink to take
	a link contents as well as a page number.
	(\iflinkentrytext): New conditional.
	(\startcontents): Set it.
	(\finishentry) [pdfTeX, XeTeX]: Use \pdflinkpage if \iflinkentrytext
	is true to allow clicking on the section title as well as the page
	number.

	(\shortchapentry, \shortunnchapentry, \dochapentry, \dosecentry,
	(\dosubsecentry, \dosubsubsecentry): Do not call \dopageno or
	\doshortpageno, as these surround the page number with TeX commands
	that get in the way in \pdflinkpage and appear to be unnecessary.
	(\dopageno, \doshortpageno): Remove.

2022-12-03  Patrice Dumas  <pertusus@free.fr>

	Gather tree information when closing incorrectly nested @def* lines

	* tp/Texinfo/ParserNonXS.pm (_close_current, _end_line_def_line)
	(_end_line), tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_def_line, end_line):
	when ending a @def*x? command line because it was interrupted or
	at the end of the file, use the same code as the code used at the
	end of line, put in the end_line_def_line() function to gather
	information on the line and separate arguments with roles.

	* tp/t/57invalid_nestings.t: move section_on_defx_line to
	@formatted_cases.

2022-12-03  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): ignore @def*
	arguments that have not been split off with a role added from the @def
	line args.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	Run gnulib-tool --add-import mkstemp.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	Atomic dir update

	* install-info/install-info.c (output_dirfile): Write to
	file created by mkstemp first, then rename this to the real
	output file. 
	* TODO: Remove item.

	Report from Pedrum Mohageri, bug-texinfo, November 2015.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Directory Category), TODO: Do not refer
	to Free Software Directory categories.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* configure.ac: Do not add js/node_modules/.bin/ to program
	search path if the directory does not exist.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/maintain/regenerate_file_lists.pl: Hardcode script name
	to be placed in Makefile.tres, so it will not change depending
	on where it was run from, e.g. from autogen.sh.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* configure.ac, util/texi2pdf, js/info.js: bump version to 7.0dev.
	* README-hacking: remove duplicate instruction

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/tests/run_parser_all.sh (post_process_output): Strip
	line with missing file error from logs for predictable results.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/texi2any.pl: Strip directories from filename in warning for
	predicatable results in test suite.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* configure.ac (AM_INIT_AUTOMAKE): Remove dist-xz option for
	development as it is too slow.

2022-12-03  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/texi2any.pl: Give a warning if input filename ends in '.info'.
	* NEWS, TODO: Update.
	* tp/tests/formatting/list-of-tests (info_extension_warning):
	New test.

2022-12-02  Gavin Smith  <gavinsmith0123@gmail.com>

	* NEWS, doc/texinfo.texi (Heading Generation, @headings)
	(Custom Headings): Update now that @titlepage does not do
	"@headings on".

2022-12-02  Gavin Smith  <gavinsmith0123@gmail.com>

	Make texi2dvi -t '@headings double' work

	* doc/texinfo.tex (\setchapternewpage): Call \HEADINGSon as
	we are not relying on it being called inside @titlepage any more.

2022-12-02  Gavin Smith  <gavinsmith0123@gmail.com>

	Make texi2dvi -t '@headings double' work

	* doc/texinfo.tex: Call \HEADINGSon to set headings from very start
	of file.
	(\titlepage): Call \headingsoff to turn off headings temporarily.
	Do not call \HEADINGSon as this may override a
	texi2dvi -t '@headings double' setting.  Reset page number with
	\pageone.

2022-12-02  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/window.h: Eliminate #define used to use the same three fields
	in two different structures, as the comment explaining it took
	more space up than it would have taken simply to write the lines
	twice.

2022-12-02  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/session.c (info_beginning_of_line): Avoid freezing
	at beginning of a file when 'nodeline' is set to 'pointers' (the
	default).  Report from Justin Anthony LaPolla <justin.lapolla@hpe.com>.

2022-12-02  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_format_columnfractions)
	(_convert): add a separate function to format columnfractions command,
	_format_columnfractions().  Use that function to format a bogus
	@columnfractions out of @multitable.

2022-12-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert), util/txixml2texi.pl,
	util/texinfo.dtd: use spacesaftercmd attribute for
	spaces_after_cmd_before_arg for accent commands too.

	* util/texinfo.dtd: add two-letter based index entries index commands.
	Add microtype.  Allow formfeed and verticaltab in menuleadingtext.
	Allow headingmark in style commands.  Add diverse space attributes in
	associated elements, in particular in brace commands.

2022-12-01  Patrice Dumas  <pertusus@free.fr>

	Protect spaces in space attributes in XML specific code

	* tp/Texinfo/Convert/TexinfoMarkup.pm,
	tp/Texinfo/Convert/TexinfoXML.pm (_xml_attributes): protect spaces
	in space attributes in format specific code.

2022-11-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert),
	tp/Texinfo/Convert/TexinfoXML.pm (_xml_attributes),
	util/txixml2texi.pl (unprotect_spaces): add attribute for
	spaces_after_cmd_before_arg info, protect special spaces in it
	and unprotect in txixml2texi.pl.

2022-11-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): add end lines
	after the closing markup element when @end is missing.

2022-11-30  Patrice Dumas  <pertusus@free.fr>

	Gather tree information when closing incorrectly nested line command

	* tp/Texinfo/ParserNonXS.pm (_close_current, _end_line_misc_line)
	(_end_line), tp/Texinfo/XS/parsetexi/close.c (close_current),
	tp/Texinfo/XS/parsetexi/end_line.c: when closing line_arg in
	close_current, use the same code as when closing at end of line,
	such as to gather all the information in the tree, in particular
	rearranging @end in block command and output all the error messages.

2022-11-30  Gavin Smith  <gavinsmith0123@gmail.com>

	* configure.ac (AM_INIT_AUTOMAKE): Remove 'readme-alpha' option,
	as we are using three-part version numbers that do not signify
	alpha releases.

2022-11-30  Gavin Smith  <gavinsmith0123@gmail.com>

	* NEWS: Add 7.0.1 news.

2022-11-29  Per Bothner  <per@bothner.com>

	* js/info.css (cache_index_links): Fix index entry processing.
	Also implement subentry handling.
	(init_iframe - on_load): Change search and call of cache_index_links.

2022-11-29  Per Bothner  <per@bothner.com>

	* js/info.css (.tex-input): Make input element a bit wider.
	This works better for longer index or menu names.

2022-11-29  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (output_texi_file): always add a newline in the
	end of the test Texinfo code.

2022-11-29  Patrice Dumas  <pertusus@free.fr>

	* util/txixml2texi.pl: avoid double comment for line specific command.

2022-11-28  Patrice Dumas  <pertusus@free.fr>

	Protect vertical tab in XML

	* tp/Texinfo/Convert/TexinfoMarkup.pm
	(_protect_in_spaces_attribute_text), tp/Texinfo/Convert/TexinfoXML.pm
	(_xml_attributes, _protect_text), util/txixml2texi.pl,
	util/texinfo.dtd: protect vertical tab U+000B as \v in attributes and
	with verticaltab added entities in other contexts.

2022-11-28  Patrice Dumas  <pertusus@free.fr>

	XML menu leading text and menu separator in elements instead of attributes

	* tp/Texinfo/Convert/TexinfoMarkup.pm (%type_elements, _convert),
	util/texinfo.dtd: put menu_entry_leading_text and menu_entry_separator
	types text in element rather than in attributes.  It is better to keep
	the structure and protect spaces more naturally.

	* util/texinfo.dtd: add endspace attribute for macro and rmacro.


2022-11-27  Per Bothner  <per@bothner.com>

	* js/info.js (on_link): Change query pattern for links.
	Use class printindex-index-section instead of printindex-index-entry
	to get the correct node URL.

2022-11-27  Per Bothner  <per@bothner.com>

	* js/info.js (set_current)url): Don't set parameter default.
	It's not needed, and it triggers an eslint complaint,
	because parameter default values were new in EcmaScript 6 (2015).

2022-11-27  Patrice Dumas  <pertusus@free.fr>

	* maintain/check_back_xml_forth_texi_t.sh: script to test conversion
	of tp/t/*.t Texinfo code to Texinfo XML and back to Texinfo to detect
	issues with Texinfo XML conversion and conversion back to Texinfo.

2022-11-27  Patrice Dumas  <pertusus@free.fr>

	* util/txixml2texi.pl: skip a comment after <columnfractions> as
	the comment is already in the line attribute.

2022-11-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): do not have
	an empty columnprototypes when there is an empty columnfraction,
	but only have a columnfraction.
	Avoid autovivification of extra columnfraction in case of empty
	columnfraction.

2022-11-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/TexinfoMarkup.pm (_convert): correctly use
	_leading_spaces_arg return in case there is no space after @end
	command line and something else on the line.

2022-11-27  Patrice Dumas  <pertusus@free.fr>

	* tp/t/test_utils.pl (output_texi_file): encode to UTF-8 the resulting
	Texinfo file.  Only when the test texinfo comes from perl code and not
	when reading from a file as when reading from a file there is no
	decoding.

2022-11-27  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item),
	tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item):
	Reparent trailing comments from before_item to table_term.

2022-11-27  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/tests/coverage_macro.texi: Readd removed content.  From
	Patrice.

2022-11-27  Gavin Smith  <gavinsmith0123@gmail.com>

	@itemx at beginning of table is an error

	* tp/Texinfo/ParserNonXS.pm (gather_previous_item),
	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item),
	NEWS: @itemx at beginning of table is an error, not a warning,
	as with recent changes this gives invalid HTML and DocBook output.
	Suggestion from Patrice.

2022-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%default_converter_customization): update
	TEXINFO_DTD_VERSION to 7.1 to check more easily that tests are
	valid.

2022-11-26  Patrice Dumas  <pertusus@free.fr>

	* util/texinfo.dtd, configure.ac (TEXINFO_DTD_VERSION): add the
	index entries in tableterm before the @item.

2022-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): output <term> when
	table_term container is seen and not for @item, to also enclose
	index entries in table_term before the @item (same as in html).

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi: Move index commands before @item in @table
	throughout.

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (gather_previous_item),
	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item):
	Reparent trailing index commands from before_item to table_term.

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	Remove relate_index_entries_to_table_entries_in_tree

	* tp/Texinfo/Common.pm (texinfo_special_joint_transformation)
	(relate_index_entries_to_table_entries_in_tree): Remove.
	* tp/texi2any.pl: Do not use relate_index_entries_to_table_entries
	transformation for HTML or LaTeX.

2022-11-26  Patrice Dumas  <pertusus@free.fr>

	* doc/tp_api/Makefile.am (MAKEINFO): add -I $(top_builddir)/tp/
	to find Texinfo::ModulePath in out-of-source builds.  Report
	from Arsen Arsenović.

2022-11-26  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_table_term_type): add the
	<dt> in front in _convert_table_term_type.  Remove
	_open_table_term_type.

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (gather_previous_item),
	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item):
	Leave trailing index entries if no command follows.
	* tp/t/22xtable.t (index_command_before_end_table): New test.

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/t/22xtable.t (inter_item_commands_in_table): Move test
	here of @cindex directly between @item and @itemx.
	* tp/tests/coverage_macro.texi: Remove cases tested in t/22xtable.t.

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	Output index anchors inside <dt>

	* tp/Texinfo/ParserNonXS.pm (gather_previous_item),
	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item):
	Do not absorb trailing index entries into a table_definition element.

	* tp/Texinfo/Convert/HTML.pm
	(_open_table_term_type): New function simply to output <dt>.  Add
	it to %default_types_open for 'table_term'.
	(_convert_table_term_type): Dummy function to enable
	_open_table_term_type.
	(_convert) <open type>: Concatenate any result from an "open type"
	handler rather than overwriting it.
	(_convert_item_command): Do not output '<dt>' for @item, as
	_open_table_term_type did this.  Output any index anchor immediately
	after the <dt> as an <a> element rather than setting an 'id' attribute
	on the <dt> tag.

2022-11-26  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (gather_previous_item):
	Use splice operation instead of moving items one by one when
	creating table_term element.  No functional changes intended.

2022-11-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (gather_previous_item),
	* tp/Texindo/XS/parsetexi/element_types.txt:
	Rename 'table_item' to 'table_definition'.

2022-11-25  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item),
	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item).
	* tp/Texinfo/Common.pm (_relate_index_entry_to_table_entry):
	Revert last change.

2022-11-22  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item),
	* tp/Texinfo/XS/parsetexi/multitable.c (gather_previous_item):
	Include index entries in table_term element.
	* tp/Texinfo/Common.pm (_relate_index_entry_to_table_entry):
	Look for index command in table_term rather than table_item.

2022-11-22  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (command_text, _convert_xref_commands)
	(_initialize_output_state): add 'referred_command_stack' to put
	commands that can be referred to being expanded, to catch if an @*ref
	refers to that command during the expansion, leading to an infinite
	recursion.  In that case, use the node instead of the section, as with
	nodes only it is not possible to construct a an infinite recursion
	as the node must both be a reference target and refer to a specific
	target at the same time, which is not possible.  Report from David
	Bacon.

2022-11-21  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command): do not add
	an empty cell on the letter row.  That way it is possible to add
	a colspan or have only one cell.

2022-11-21  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/ParserNonXS.pm (_gather_previous_item):
	Splice end of contents array instead of unshifting items from
	end one at a time.  No functional changes intended.  This should
	make it simpler to work forwards and find index commands
	immediately following @item and/or @itemx.

2022-11-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command): remove
	span element used for index-entry-level-*, instead add the class to
	the td element.
	Remove classes for empty sectioning cells.
	Report from Per Bothner.

2022-11-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output): create empty js files for
	tests.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/tests/layout/list-of-tests (formatting_epub_nodes):
	Set INFO_JS_DIR in order to exercise code.  From Patrice.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/HTML.pm (output) <INFO_JS_DIR>:
	Do not copy js files for tests.

2022-11-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%css_element_class_styles): increase
	index subentries indenting.  Suggestion from Raymond Toy.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* js/info.js (on_load): Update version number.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking: info.js needs version update

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/tests/layout/list-of-tests (formatting_epub_nodes):
	Do not set INFO_JS_DIR to avoid test result having to be
	updated every time one of the js files changes.

2022-11-20  Patrice Dumas  <pertusus@free.fr>

	* tp/DebugTexinfo/DebugTree.pm (_print_tree): use info element key
	instead of extra for information now associated to that key.

2022-11-20  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (output_internal_links): add subentries
	to index entries text.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	info.js improvements

	* js/info.css: No underlining for sidebar links.
	* js/info.js: Remove "Hide sidebar" text as it takes up too much
	space.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* js/info.js (add_header): Check for h1.top after h1.settitle
	for text to put at top of sidebar.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* js/info.js (init_iframe): Change selector for index entries
	to match new HTML output.  From Per and Patrice.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking: say to test JS interface manually before a release
	* README: list js/ directory here.

2022-11-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Convert/HTML.pm (%defaults): Change INDEX_ENTRY_COLON
	from ':' to ''.  Suggestion from Patrice.

2022-11-18  Gavin Smith  <gavinsmith0123@gmail.com>

	* contrib/my-bib-macros.texi: Move here from web pages.

2022-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command): use
	padding in CSS instead of non breaking space in a column to add
	a space between index entry and section or node in printindex HTML
	formatting.  Report from Per Bothner.

2022-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (comma_index_subentries_tree),
	tp/Texinfo/Convert/HTML.pm (_prepare_index_entries): use subentries
	to determine the identifier of an index entry.  Add an optional
	separator argument to comma_index_subentries_tree() to be able to
	use something else than a comma.  Use a space separator to determine
	the identifier to keep it shorter.

2022-11-19  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (%css_element_class_styles): use
	padding-left instead of margin-left for index-entry-level-*, it
	is more appropriate.  Report from Per Bothner.

2022-11-19  Patrice Dumas  <pertusus@free.fr>

	* po_document/Makevars (XGETTEXT_OPTIONS): add --from-code=UTF-8
	for an non-ASCII encoded character in a comment in tp/ext/epub3.pm.
	Update po files.

2022-11-19  Patrice Dumas  <pertusus@free.fr>

	Add Pod/Simple/Texinfo.pm HTML output to wwwdoc

	* doc/Makefile.am (wwwdoc-build, wwwdoc-install): add
	Pod/Simple/Texinfo.pm HTML output, link Pod/Simple/Texinfo.pm and call
	pod2html such that a relative link to Pod/Simple/Texinfo.html is
	actually output.

2022-11-19  Patrice Dumas  <pertusus@free.fr>

	* doc/Makefile.am (po-check, po_document-check), README-hacking,
	po_document/POTFILES.in, tp/Texinfo/ParserNonXS.pm: add __p to
	po-check regexp, remove gdt.  Add po_document-check target similar
	to po-check for po_document/POTFILES.in.  Update po_document/POTFILES.in
	with the files found.
	In ParserNonXS.pm, add a useless $self argument to gdt( in comment to
	avoid getting caught in po_document-check.

2022-11-18  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/Makefile.am (wwwdoc-build): Pass --quiet flag to pod2html.

2022-11-18  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/Texinfo.pm,
	tp/Texinfo/Convert/TexinfoMarkup.pm, tp/Texinfo/ParserNonXS.pm
	(_isolate_last_space), tp/Texinfo/Transformations.pm,
	tp/Texinfo/XS/parsetexi/extra.c (add_info_element_oot),
	tp/Texinfo/XS/parsetexi/parser.c (isolate_last_space): move
	comment_at_end from extra to info in element.

2022-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Texinfo.pm, tp/Texinfo/Convert/TexinfoMarkup.pm,
	tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/element_types.txt,
	tp/Texinfo/XS/parsetexi/extra.c (add_info_string),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line): rename
	spaces type used for spaces after command before argument or opening
	brace as spaces_after_cmd_before_arg and move it to info in element.

2022-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Texinfo.pm (_expand_cmd_args_to_texi): remove
	redundant conditions.

2022-11-17  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm, tp/Texinfo/Convert/Texinfo.pm,
	tp/Texinfo/Convert/TexinfoMarkup.pm, tp/Texinfo/ParserNonXS.pm
	(_parse_macro_command_line, _close_brace_command)
	(_process_remaining_on_line), tp/Texinfo/XS/parsetexi/close.c
	(close_brace_command), tp/Texinfo/XS/parsetexi/convert.c
	(expand_cmd_args_to_texi), tp/Texinfo/XS/parsetexi/handle_commands.c
	(handle_line_command), tp/Texinfo/XS/parsetexi/macro.c
	(parse_macro_command_line), tp/Texinfo/XS/parsetexi/parser.c
	(process_remaining_on_line), tp/Texinfo/XS/parsetexi/separator.c
	(handle_open_brace): move arg_line and @verb delimiter from extra to
	info in element.

2022-11-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/t/recode-C-locale.sh: New test.

2022-11-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* info/util.c (text_buffer_iconv): Avoid infinite loop
	by updating space left argument passed to iconv, and by
	continually expanding the allocated space in the output buffer
	if iconv continues to return E2BIG.
	Hang on UTF-8 encoded file with LC_ALL=C reported by
	Hilmar Preuße <hille42@web.de>.

2022-11-16  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/Texinfo.pm,
	tp/Texinfo/Convert/TexinfoMarkup.pm,
	tp/Texinfo/Convert/TextContent.pm, tp/Texinfo/ParserNonXS.pm,
	tp/Texinfo/Structuring.pm, tp/Texinfo/XS/misc.c (xs_abort_empty_line),
	tp/Texinfo/XS/parsetexi/convert.c (expand_cmd_args_to_texi)
	(convert_to_texinfo_internal),
	tp/Texinfo/XS/parsetexi/handle_commands.c (handle_line_command),
	tp/Texinfo/XS/parsetexi/parser.c (abort_empty_line)
	(isolate_last_space_internal): move spaces_before_argument and
	spaces_after_argument from extra to info key element hash.

	* tp/Texinfo/XS/parsetexi/extra.c (lookup_associated_info)
	(lookup_extra, lookup_info): add lookup_associated_info to lookup in
	an associated information structure.  Add wrappers for the info and
	extra structures.

	* tp/Texinfo/Convert/DocBook.pm (_convert): check 'args' and not
	'extra' to determine if there is a @quotation argument.

	* tp/Texinfo/ParserNonXS.pm (_end_line): remove extra element key if
	empty after removing incorrect command_as_argument.  Avoid
	autovivification.

2022-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm, tp/Texinfo/Convert/LaTeX.pm,
	tp/Texinfo/Convert/Plaintext.pm, tp/Texinfo/Convert/Plaintext.pm,
	tp/Texinfo/ParserNonXS.pm (_process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/api.c (element_to_perl_hash),
	tp/Texinfo/XS/parsetexi/end_line.c (end_line_starting_block),
	tp/Texinfo/XS/parsetexi/extra.c (add_info_string_dup),
	tp/Texinfo/XS/parsetexi/parser.c (process_remaining_on_line),
	tp/Texinfo/XS/parsetexi/tree.c (new_element, destroy_element):
	add an info hash to the tree elements, for information that can not
	be retrieved from the tree.  As a first information moved from
	extra to info, put the @value flag name for @value with unset flag.

2022-11-15  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/api.c (store_additional_info)
	(element_to_perl_hash), tp/Texinfo/XS/parsetexi/end_line.c
	(end_line_starting_block), tp/Texinfo/XS/parsetexi/extra.c
	(add_associated_info_key, lookup_extra),
	tp/Texinfo/XS/parsetexi/tree.c (new_associated_info, new_element)
	(destroy_associated_info, destroy_element),
	tp/Texinfo/XS/parsetexi/tree_types.h (ASSOCIATED_INFO): instead of
	putting the extra array, the number and space directly in the
	element, use a specific structure, ASSOCIATED_INFO to hold those
	three fields.  Replace add_extra_key by add_associated_info_key
	to associate information.  Add initialization, destruction,
	lookup based on the previous code associated to extra.

2022-11-15  Gavin Smith  <gavinsmith0123@gmail.com>

	* configure.ac: Use absolute path for checking for
	npm commands so that rules in js/Makefile.am work.

2022-11-15  Gavin Smith  <gavinsmith0123@gmail.com>

	* js/yarn.lock, js/server.js: Remove files.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Texinfo.pm (root_heading_command_to_texinfo):
	show node name as it appeared in the document.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (special_element_info)
	(_set_root_commands_targets_node_files)
	(_prepare_conversion_tree_units), tp/Texinfo/Translations.pm
	(complete_indices): sort for reproducible function returns
	and messages.

	* tp/Texinfo/Convert/Converter.pm, tp/Texinfo/Convert/HTML.pm,
	tp/Texinfo/Structuring.pm: avoid perl objects in debug messages,
	keeping the perl object name output messages in comments.

	* tp/Texinfo/Convert/HTML.pm (converter_initialize): avoid
	autovivification.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/XS/parsetexi/command_data.awk: remove code for
	compatibility with old format.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Commands.pod, tp/Texinfo/Common.pm
	(_add_preamble_before_content),
	tp/Texinfo/XS/parsetexi/command_data.awk, tp/Texinfo/command_data.txt:
	add preamble flag in command_data.txt instead of determining the hash
	in Texinfo::Common.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* Pod-Simple-Texinfo/lib/Pod/Simple/Texinfo.pm
	(_texinfo_handle_element_start, _texinfo_handle_element_end): use
	Texinfo::Commands::brace_code_commands.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/ParserNonXS.pm: do not reset simple_text_commands and
	plain_text_commands to full_text_commands.

	Add a check (not enabled) that all the commands that should have
	nesting checks do.

2022-11-14  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Commands.pod, tp/Texinfo/Common.pm,
	tp/Texinfo/XS/parsetexi/command_data.awk, tp/Texinfo/command_data.txt:
	move command classification out of Texinfo::Common to
	command_data.txt.  Filter out flags not relevant for the XS parser
	when generating command_data.c.
	Update callers.

2022-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (EXTRA_DIST), tp/Texinfo/XS/Makefile.am,
	tp/Texinfo/command_data.txt: move command_data.txt from
	tp/Texinfo/XS/ to tp/Texinfo/ since it is now used both in perl
	modules and in the XS parser.

2022-11-13  Patrice Dumas  <pertusus@free.fr>

	* tp/Makefile.am (test_files): add t/init/*.pm files.

2022-11-13  Patrice Dumas  <pertusus@free.fr>

	* util/texi2dvi (--expand): add --iftex and --no-ifinfo to
	makeinfo call.  Use -c TEXINFO_OUTPUT_FORMAT=plaintexinfo
	instead of --macro-expand=- to avoid the conversion to Info
	that could lead to irrelevant messages.

	* doc/texinfo.texi (Format with @command{texi2dvi} or
	@command{texi2pdf}): no more comments set by texi2dvi.

2022-11-13  Gavin Smith  <gavinsmith0123@gmail.com>

	* util/texi2dvi (--expand): Remove lengthy block of code
	using sed to comment out @tex blocks.  Suggestion from Patrice.
	* NEWS, TODO, README-hacking: update

2022-11-12  Werner Lemberg  <wl@gnu.org>

	* doc/texinfo.tex (\unicodechardefs): Add missing % after }.

2022-11-12  Werner Lemberg  <wl@gnu.org>

	* doc/texinfo.tex (\textdegree): Define using \tcfont to
	enable copying the right character from a PDF reader.

2022-11-12  Patrice Dumas  <pertusus@free.fr>

	* util/htmlxref.cnf: add manuals, in particular mono manuals
	and fix some issues with existing manuals. Report from Tzvetelin
	Katchov.
	Rename mairix manual as mairix-el, and smalltalk* manuals as
	gst*.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (\defmacro): Use \begingroup and
	\endgroup around code reading macro arguments, instead
	of \bgroup and \egroup, as the former do not form a
	"subformula" when used in math mode, which affects the
	spacing.  Suggestion from Vincent Lefèvre.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/gendocs.chapter/gendocs_template: New file.
	* doc/Makefile.am (wwwdoc-build): Use it for texi2any_internals
	manual, as default template does not handle chapter-split
	manuals.

2022-11-12  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (HTML Xref 8-bit Character Expansion):
	update codepoint in example of Xref with @point.

2022-11-12  Patrice Dumas  <pertusus@free.fr>

	Use U+22C6 for @point to get a smaller and more pointy star

	* NEWS, doc/texinfo.texi (HTML Xref Command Expansion),
	tp/Texinfo/Convert/Unicode.pm (%extra_unicode_map),
	tp/tests/coverage_macro.texi: use U+22C6 for @point both
	to get a star more in line with the star obtained with TeX
	also more similar to the asterisk also used, more pointy.
	This changes the HTML corss-references to nodes with @point.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* util/htmlxref.cnf (texi2any_internals): Remove node line
	to prefer split-by-chapter.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/Makefile.am (wwwdoc-build): Split texi2any_internals
	by chapter.  Report from Patrice.  Suppress Info node name
	warnings for texi2any_api and texi2any_internals.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* util/htmlxref.cnf (texi2any_internals): Add split-by-chapter
	line.  Report from Patrice.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking: remove to-do item

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking: collect info on version update.  texi2dvi
	and texi2pdf uploads needed after version update.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking, texindex/ti.twjr: Update year reported
	by texindex --version.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\textdegree, \unicodechardefs): Supply definition
	that looks better in a tt font.  Also work inside math.  Report from
	Werner.

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* NEWS: correct spelling of "@definfoenclose" in most
	recent release announcement

2022-11-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Macro Details): Add problem with macro
	expansion inside of @math.  Report from Vincent Lefèvre.

2022-11-11  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.tex (\unicodechardefs): Use \arrow instead of
	\expansion for U+2192.  From Patrice.

2022-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/coverage_macro.texi: add UTF-8 encoded characters near to
	accented characters obtained with @-commands.

2022-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (%preamble_commands): fix typo on direntry
	command name.

	* tp/tests/layout/formatting.texi: add @latex \DeclareUnicodeCharacter
	for characters not in the default inputenc/fontenc.

2022-11-11  Patrice Dumas  <pertusus@free.fr>

	* tp/tests/coverage_macro.texi: add UTF-8 encoded characters near to
	@-commands to be able to check visually the difference in formatting.

2022-11-10  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/Texinfo/Common.pm, tp/Texinfo/Convert/HTML.pm,
	tp/Texinfo/Convert/Utils.pm, tp/Texinfo/Translations.pm: edits
	translation comments for grammar.

	Update po files.

2022-11-10  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Translation Contexts): edit.

2022-11-10  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Translations Output and Customization):
	translated strings can also be specified for specific elements
	headings customization, refer to the node.

2022-11-10  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Customizing Footnotes@comma{} Tables of
	Contents and About, Special Element Body Formatting Functions):
	merge 'Common Customization of Special Elements' in 'Customizing
	Footnotes@comma{} Tables of Contents and About'.

2022-11-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command): put
	hyperlink within span used for indentation of subentries.

2022-11-09  Gavin Smith  <gavinsmith0123@gmail.com>

	* configure.ac (AM_INIT_AUTOMAKE): Increase required automake
	version to 1.16.2.  From Patrice.

2022-11-09  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Translation Contexts),
	tp/Texinfo/Convert/HTML.pm (%direction_type_translation_context)
	(direction_string, special_element_info): add translation contexts
	for direction strings and special elements headings.

	* tp/Texinfo/Translations.pm (pgdt): find gdt() through the
	first argument object.

2022-11-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm, tp/Texinfo/Convert/LaTeX.pm,
	tp/Texinfo/Convert/Plaintext.pm, tp/Texinfo/Convert/Utils.pm: add
	comments for translators.

	Update po files.

2022-11-09  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (float_name_caption): remove useless
	end of lines in translated strings.  Add comments for translators.

	Update po files.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* po_document/Makevars (XGETTEXT_OPTIONS): update pgdt order.

	* tp/Texinfo/Translations.pm (complete_indices): use '{name} of {class}'
	for index entry for @defcv too.

	Update po files.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* po_document/Makevars (XGETTEXT_OPTIONS): add -cTRANSLATORS

	* tp/Texinfo/Common.pm (%def_map): add either a # TRANSLATORS:
	comment, or use pgdt to give context.  Use pgdt when the same string
	is used for different @-commands.
	Update test results as some translations are missing after getting
	a context.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Report.pm (line_warn, document_warn), tp/texi2any.pl
	(document_warn): remove \n from translated string marked for
	translation with __p.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/IXIN.pm, tp/Texinfo/Convert/TexinfoMarkup.pm,
	tp/Texinfo/Convert/Utils.pm: convert only if contents are defined,
	initialize contents if needed.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (_prepare_conversion, _title_font)
	(_convert): convert only if contents are defined.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Converter.pm (sort_element_counts): use
	node name only if set.
	Add a space between sectioning command and @-command and name.

	* tp/texi2any.pl: fix SORT_ELEMENT_COUNT by requiring the correct
	module.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/DocBook.pm (_convert): avoid formatting when
	contents is not set.

	* tp/Texinfo/Convert/Converter.pm (table_item_content_tree):
	explicitely handle undef $contents argument.

2022-11-08  Gavin Smith  <gavinsmith0123@gmail.com>

	* doc/texinfo.texi (Adding Output Formats): Update name of
	texi2any_internals manual.
	* util/htmlxref.cnf: Add texi2any_api, texi2any_internals.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm: avoid formatting when contents
	is not set, avoiding a crash with empty @titlefont as title.

	* tp/Texinfo/Convert/Plaintext.pm (_convert): do not format
	author if there is no contents, this cannot happen for now but is more
	robust.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Info.pm (_convert): avoid crashes in case
	of empty arguments.

2022-11-08  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/Info.pm (format_image): avoid crash on empty
	@image extension.  Report from Werner Lemberg.

2022-11-08  Gavin Smith  <gavinsmith0123@gmail.com>

	* tp/texi2any.pl: Call _encode_message on messages passed to
	"die" to avoid "Wide character in die" warning.  Report from
	Werner.

2022-11-05  Patrice Dumas  <pertusus@free.fr>

	Do not use FirstInFile in direction strings, document FirstInFile

	* tp/Texinfo/Convert/HTML.pm (direction_string): strip leading
	FirstInFile from direction when looking for the associated strings.

	* doc/texi2any_api.texi (Directions, Direction Strings): document
	directions with FirstInFile prepended.

2022-11-05  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Structuring.pm (check_nodes_are_referenced): consider
	that a node is referenced if it appears in a manu that would be
	setup automatically.  That is if a node has automatic direction,
	no menu, all the children determined by automatic directions are
	considered to be referenced.
	(get_node_node_childs_from_sectioning): avoid spurious
	auto-vivification.

2022-11-04  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Common.pm (pgdt): add pgdt that does nothing to
	be able to marks translated strings with a translation context.

2022-11-04  Patrice Dumas  <pertusus@free.fr>

	* NEWS: update with @subentry, @seealso and @seeentry formatting
	in HTML.

2022-11-04  Patrice Dumas  <pertusus@free.fr>

	Format index entry with @seealso or @seeentry in HTML

	* tp/Texinfo/Convert/HTML.pm (_convert_printindex_command):
	format entry with @seealso or @seeentry similarly with Texinfo
	TeX.

2022-11-04  Patrice Dumas  <pertusus@free.fr>

	Format @subentry in HTML similarly as in printed output

	* tp/Texinfo/Convert/Converter.pm (comma_index_subentries_tree),
	tp/Texinfo/Convert/HTML.pm (_convert_printindex_command):
	pass directly the first element with a possible subentry to
	comma_index_subentries_tree to be able to start frmo a subentry, not
	only from the main entry.
	Format subentries in HTML by indenting and not redoing the formatting
	of previous lines first levels, similar with Texinfo TeX.

2022-11-03  Patrice Dumas  <pertusus@free.fr>

	Also use subentries for index entries sorting in texi2any

	* tp/Texinfo/Structuring.pm (_sort_index_entries, sort_indices):
	collect subentries sorting keys and use them to sort the index
	entries.

2022-11-03  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Simple Customization for Commands Without
	Arguments), tp/Texinfo/Config.pm
	(texinfo_register_no_arg_command_formatting),
	tp/Texinfo/Convert/HTML.pm (_translate_names): allow to set
	a Texinfo code to be translated and converted as command without
	arguments output.

2022-11-02  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Simple Navigation Panel Customization):
	describe ACTIVE_ICONS and PASSIVE_ICONS more explicitely.

2022-11-02  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Simple Navigation Panel Customization):
	add CHAPTER_FOOTER_BUTTONS, update explanations.

2022-11-01  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/LaTeX.pm (%LaTeX_encoding_names_map)
	(_latex_header): associate both a fontenc and an inputenc to
	an encoding.
	Separate the 'fixed' part of the LaTeX use package part of preamble at
	the beginning, including inputenc and fontenc and the usepackage
	lines determined by the use of Texinfo commands.

2022-11-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texinfo.texi (@command{texi2html}): update now that translated
	strings customization is done.

	* doc/texi2oldapi.texi: update to expand history to the point where
	the texi2html implementation was abandonned.  Mark that the part on
	the early texi2any API has been obsoleted by texi2any_api.

2022-11-01  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Common Customization of Special Elements)
	(Special Elements Information Customization)
	(Special Element Body Formatting Functions), tp/Texinfo/Common.pm
	(@variable_other_settables), tp/Texinfo/Config.pm
	(_GNUT_initialize_special_element_info)
	(texinfo_register_special_element_info,
	GNUT_get_special_element_info), tp/Texinfo/Convert/HTML.pm
	(special_element_info, _translate_names, converter_initialize):
	change information on special elements to be set with a function,
	texinfo_register_special_element_info in Texinfo::Config, retrieved in
	the Converter with GNUT_get_special_element_info, instead of using
	customization variables.  Add the special_element_info function to
	retrieve the special elements information in the HTML Converter,
	translating special element headings only when needed.  Allow special
	element headings and targets to be undef.
	Remove SPECIAL_ELEMENTS_HEADING, SPECIAL_ELEMENTS_CLASS,
	SPECIAL_ELEMENTS_DIRECTIONS, special_elements_targets,
	special_elements_file_string and special_elements_order customization
	variables.

2022-10-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_prepare_special_elements): for
	special elements order, use a hash with indices to be used to order
	the special elements instead of an array.  More code, but much easier
	to customize/modify.

2022-10-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm: remove 'Top' from %defaults
	'special_elements_targets', instead hardcode the empty @top target in
	the code.

2022-10-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_load_htmlxref_files): do not
	set htmlxref_files converter state, use a regular array.

	* tp/Texinfo/Convert/HTML.pm (_external_node_href): remove
	_htmlxref, access directly the 'htmlxref' converter state.

2022-10-31  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Translated Strings Customization),
	tp/init/documentation_examples.pm (my_format_translate_string):
	add translation strings customization example in
	documentation_examples.pm and fix in manual.

2022-10-31  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Config.pm (texinfo_register_direction_string_info):
	set converted string structure only if the argument is defined.

2022-10-30  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Direction Strings Customization)
	(Getting Direction Strings), tp/Texinfo/Config.pm
	(texinfo_register_direction_string_info), tp/Texinfo/Convert/HTML.pm
	(direction_string, converter_initialize): add context information to
	direction strings customization to be able to convert in string
	and in normal context.  Update calls of direction_string() to use the
	string context for strings that end up in attributes.

2022-10-30  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Translations.pm (gdt, replace_convert_substrings):
	Split replace_convert_substrings out of gdt, corresponding to the
	substitution of replaced_substrings and conversion to Texinfo
	tree.

	* doc/texi2any_api.texi (Internationalization of Strings Function)
	(Translations Output and Customization)
	(Translated Strings Customization): add a whole chapter on
	strings internationalization, grouping Internationalization of Strings
	Function and information formerly in Basic Formatting Customization.

	* tp/t/test_utils.pl (test), tp/Texinfo/Config.pm
	(_GNUT_initialize_stage_handlers)
	(_GNUT_initialize_no_arg_commands_formatting_strings)
	(_GNUT_initialize_style_commands_formatting_info)
	(GNUT_reinitialize_init_files): add initialization of init files
	information in Texinfo::Config to isolate tests.

2022-10-29  Patrice Dumas  <pertusus@free.fr>

	Add customization of translated strings

	* doc/texi2any_api.texi (Internationalization of Strings Function)
	(Basic Formatting Customization), tp/Texinfo/Convert/HTML.pm (gdt):
	override Texinfo::Translations gdt to call format_translate_string
	user-defined formatting reference if the formatting reference is
	defined.
	Document more arguments of gdt, as they are also used for
	format_translate_string.

2022-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (direction_string, _translate_names):
	translate direction strings only when needed and cache them
	afterwards.  Remove the contents of the translated direction
	string types in _translate_names such that they will be re-translated
	in the next direction_string call.

2022-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_convert_informative_command, _convert):
	call _translate_names() after documentlanguage conversion in converter
	code instead of calling in conversion function.

2022-10-29  Patrice Dumas  <pertusus@free.fr>

	* tp/Texinfo/Convert/HTML.pm (_translate_names): update gdt call.

2022-10-29  Patrice Dumas  <pertusus@free.fr>

	* doc/texi2any_api.texi (Element Direction Information Type)
	(Direction Strings, Getting Direction Strings), tp/Texinfo/Common.pm
	(@variable_other_settables), tp/Texinfo/Config.pm
	(texinfo_register_direction_string_info)
	(GNUT_get_direction_string_info), tp/Texinfo/Convert/HTML.pm
	(direction_string, _translate_names, converter_initialize)
	(_initialize_output_state): change customization of direction strings
	to be set with texinfo_register_direction_string_info, retrieved in
	the converter by GNUT_get_direction_string_info, translated when
	needed and retrieved in formatting code with direction_string, instead
	of using curtomization variables.  Remove the customization variables
	BUTTONS_TEXT, BUTTONS_NAME, BUTTONS_GOTO, BUTTONS_REL,
	BUTTONS_ACCESSKEY, BUTTONS_EXAMPLE.  Update functions that used the
	BUTTONS_* customization variables.

	* tp/Texinfo/Convert/HTML.pm (ACTIVE_ICONS, PASSIVE_ICONS): do not
	initialize ACTIVE_ICONS and PASSIVE_ICONS to empty strings, instead
	set to undef the customization variables as a whole.

2022-10-27  Patrice Dumas  <pertusus@free.fr>

	Add optional translation context for in-document string translations

	* doc/texi2any_api.texi (Internationalization of Strings Function),
	tp/Texinfo/Translations.pm (gdt, pgdt), po_document/Makevars
	(XGETTEXT_OPTIONS), tp/Texinfo/Convert/HTML.pm (_translate_names):
	add a translation context argument to gdt() and add pgdt() which
	has the translation context as first argument.
	Update po_document/Makevars to have pgdt arguments in the correct
	order.

2022-11-07  Gavin Smith  <gavinsmith0123@gmail.com>

	* README-hacking: new ChangeLog file done


Copyright 2022 Free Software Foundation, Inc.

Copying and distribution of this file, with or without modification,
are permitted in any medium without royalty provided the copyright
notice and this notice are preserved.
